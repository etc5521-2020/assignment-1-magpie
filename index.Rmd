---
title: "ETC5521 Assignment 1"
subtitle: "Education System in the US"
team: Magpie
author:
  - Junhao Wang 
  - Priya Ravindra Dingorkar
date: "`r Sys.Date()`"
output: 
  bookdown::html_document2
---

[This assignment is for ETC5521 Assignment 1 by Team `r rmarkdown::metadata$team` comprising of `r knitr::combine_words(rmarkdown::metadata$author)`.]{style="color:#006DAE;"}

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(dplyr)
library(kableExtra)
library(ggridges)
library(ggplot2)
library(viridis)
library(hrbrthemes)
library(gridExtra)
library(scales)
library(DT)
library(plotly)
```



```{r dat-load, message = FALSE, echo=FALSE}
tuition_cost <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-10/tuition_cost.csv')

tuition_income <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-10/tuition_income.csv') 

salary_potential <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-10/salary_potential.csv')

historical_tuition <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-10/historical_tuition.csv')

diversity_school <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-10/diversity_school.csv')
```

# Data description 

It is through data collection that a business or management has the quality information that they need for further analysis, study, and research to make informed decisions. 

We will perform exploratory, data review in this study on the subject of [**College Tuition, Diversity, and Pay Dataset**](https:/github.com / rfordatascience / tidytuesday / blob / master / data/2020/2020-03-10 / readme.md). 

This collection of data primarily receives all the information from various sources but originally from the US Department of Education.

The data, taken from the original pages, turned out to be very large in size, which is why the author, for the convenience of the audience and to produce informative results, filtered the data into five comma-separated documents using web scraping in R with the support of the rvest package.

Upon futher inspection, we also found out that some of the datasets have a few *missing values* using the visdat package. We have dealt with all of them and removed all the missing values.

Let's look at the small snippets of the various data sets and the percentage of missing values in the variables, and get a better understanding of the variables.

## Data on Diversity 

The *diversity_school* data set comes [The Chronicle of Higher Education](https://www.chronicle.com/article/student-diversity-at-4-725-institutions).

```{r}
vis_miss(diversity_school)
```

```{r}
diversity_school <- diversity_school %>%
  filter(!is.na(name)) %>%
  filter(!is.na(state))
```


```{r ds, echo=FALSE}
head(diversity_school,3) %>% kableExtra::kable() %>% kableExtra::kable_styling(c("hover" , "striped"))
```

- Name has data type character properties that describe the school name.
- Total Enrolment has double datatype properties representing the total number of students enrolled.
- State with character datatype representing the various states.
- Category with character properties defining the group Group / Racial / Gender.
- Enrolment with double datatype properties specifying the specific enrollment.
## Data on History 

The *historical_tuition* dataset been obtained from [U.S. Department of Education, National Center for Education Statistics.](https://nces.ed.gov/fastfacts/display.asp?id=76)

```{r}
vis_miss(historical_tuition)
```



```{r ht, echo=FALSE}
head(historical_tuition,3) %>% kableExtra::kable() %>% kableExtra::kable_styling(c("hover" , "striped"))
```

- type variable having character datatype describes the Type of school (All, Public, Private).
- year having character format describes the corresponding Academic year.
- tuition_type having	character datatype refers to duration of the degree, Tuition Type All Constant (dollar inflation adjusted), 4 year degree constant, 2 year constant, Current to year, 4 year current, 2 year current.
- tuition_cost having	double datatype represents the education fees/Tuition cost in USD.

## Data on Salary Potential

*Salary_potential* data set origins from [Payscales](https://www.payscale.com/college-salary-report/best-schools-by-state/bachelors/new-hampshire).

```{r}
vis_miss(salary_potential) 
```

```{r}
salary_potential <- salary_potential %>%
  filter(!is.na(make_world_better_percent))
```



```{r sp, echo=FALSE}
head(salary_potential,3) %>% kableExtra::kable() %>% kableExtra::kable_styling(c("hover" , "striped"))
```

- rank having	double datatype properties defines the potential salary rank within state.
- early_career_pay having double datatype defines the	estimated early career pay in USD.
- mid_career_pay having double datatype defines the	estimated mid career pay in USD.
- make_world_better_percent having double datatype represents the	percent of alumni who think they are making the world a better place.
-stem_percent having double datatype defines the percent of student body in science, technology, engineering and mathematics (STEM).
## Data on the Tuition Cost

The Tuition cost data set is obtained from [the Chronicle of Higher Education.](https://www.chronicle.com/article/tuition-and-fees-1998-99-through-2018-19)

```{r}
vis_miss(tuition_cost)
```
```{r}
# not removing room and board na values as we are not considering it in analysis 
tuition_cost <- tuition_cost %>% filter(!is.na(state))
```


```{r tc, echo=FALSE}
head(tuition_cost,3) %>% kableExtra::kable() %>% kableExtra::kable_styling(c("hover" , "striped"))
```

- in_state_tuition having double datatype depicts the Tuition fee for in-state residents in USD.
- out_of_state_tuition	double	Tuition for out-of-state residents in USD.

## Data on Tuition Income

The tuition income has been obtained from the dataset [Tuition Tracker](https://www.tuitiontracker.org/) and [Priceconomics.](https://priceonomics.com/ranking-the-most-and-least-diverse-colleges-in/).

```{r}
vis_miss(tuition_income,warn_large_data = F)
```



```{r ti, echo=FALSE}
head(tuition_income,3) %>% kableExtra::kable() %>% kableExtra::kable_styling(c("hover" , "striped"))
```
 
- campus having	character datatype depicts whether the school is	On or off-campus.
- net_cost having double datatype denotes Net-cost - average actually paid after scholarship/award.
- income_lvl having	character datatype gives u information about the	Income bracket.


## Data Structure and Cleaning Process

All the information gathered in these different data files was achieved by web scraping using the rvest library, html nodes, html url, and generating data set in tibble, mutating new columns and linking rows together later on. All the data was scraped and written in csv and later, the csv was read in to R environment using the readr function.

# Analysis and Findings


## Student's Career Development among American States



After graduating, a student's improvement can be calculated in terms of his salary growth. Let's look at the various states, where we see the greatest change in the salary growth.

```{r stud-develop, fig.cap="Students Career Development", fig.align='center',fig.height=6.5, message=FALSE, warning=FALSE}
# changes made --> instead of sum, grouped and took average
salary_potential <-salary_potential %>% 
  mutate(improvement= (mid_career_pay-early_career_pay)*100/early_career_pay)

 salary_potential %>% 
     group_by(state_name) %>%
   summarise(mean=mean(improvement)) %>%
  ggplot(aes(y = reorder(state_name, mean), x = mean)) +
 geom_bar(stat='identity', fill = "blue",alpha=0.5, width = 0.75) + 

  labs(x="Improvement of Salaries (%) ", 
       y="States of the US"
      ) + ggtitle("Salary Improvement")

```

To compute the improvement in a student's career, we calculated the percentage increase in an individuals salary through his career and grouped by the states and summarised using the mean to arrive at the increase in salaries across various states and reordered them.

In figure \@ref(fig:) we can clearly see that individuals graduating from universities in the states of Wyoming, New-Mexico, California, New-York and Ohio show the highest growth in mid-career salaries and the states of Delaware, North-Dakota, Alaska, Idaho and New-Hampshire show the least growth in mid-career salaries. Though there is not a huge difference between the state offering the highest growth and the state offering the least growth, figure \@ref(fig:) is a great tool to understand  student's career growth in different states.

Furthermore, we have created a table \@ref(tab:) wherein all the universities whose alumni experienced a career growth of more than 75%. We have also ranked the universities state-wise in terms of the improvement. The table enables the user to find the top universities in any state and the improvement percentage as well.

```{r improvement-rate}
top_colleges <- salary_potential %>% 
dplyr::filter(improvement >75) %>%  # changed 0.75 to 75
  dplyr::select(name, state_name, rank,improvement) 
```

```{r imp, fig.cap="Institutions showing more than 75% Improvement Rate in salaries after Education", fig.align='center'}
DT::datatable(top_colleges, 
              rownames = FALSE,
              filter="top", 
              options = list(pageLength = 5, scrollX=T))
```


## Alumni of US that Make World a Better Place to Live

Alumni serve many important positions, such as helping create and develop the brand of an organization through word-of-mouth marketing. Alumni play a significant role in promoting organizations that benefit students and their activities. Let us look at alumni from which state a better place to stay in a world.

```{r bcc, fig.cap="Alumini that make the world a better place to Live", fig.align='center', fig.height=9, fig.width=9, message=FALSE, warning=FALSE}

na <- salary_potential %>%
  filter(is.na(make_world_better_percent)) # 33 na values 

# changes made --> instead of sum, grouped and took average & used average value to color so as to distinguish properly
alumni <- salary_potential %>%
  filter(!is.na(make_world_better_percent)) %>%
  group_by(state_name) %>%
  summarise(mean=mean(make_world_better_percent))
empty_bar <- 40
 

to_add <- matrix("", empty_bar, ncol(alumni))
colnames(to_add) <- colnames(alumni)
data <- rbind(alumni, to_add)
data <- data %>%
  mutate(mean=as.numeric(mean))


data %>%
ggplot(aes(x=reorder(state_name,mean), y= mean,fill=mean)) +
  geom_bar(stat="identity") +
   theme_minimal() + 
 scale_fill_viridis_c()+
  theme(axis.title.x = element_blank(), axis.title.y = element_blank(), axis.text.y = element_blank()) + 
  ggtitle("Alumni that contribute to make a world a better place to Live")   +
  theme(axis.text.x = element_text(hjust = 5))+
  theme(plot.title = element_text(hjust = 0.5)) +
 # scale_x_discrete(guide = guide_axis(n.dodge = 2))+
  coord_polar(start = 0)
  
```

To arrive at figure  \@ref(fig:) we first removed all the missing values which were present in the variable *make_world_better_place* and grouped by the state and summarised using the mean and plotted the circular bar chart using the mean value to color the bars to distinguish appropriately. We also reordered it to clearly display the best and the worst state.

It is clear from figure \@ref(fig:) that the states New-Mexico, Mississippi and Louisana contibute the most and the states of Nevada, Rhode-Island and New-Jersey contibute the least towards making the world a better place.

## Diversity in Education in US

US is ranked amongst the top countries, showing cultural diversity. US has students coming from around the world. Let's evaluate the various groups and the percentage of US university enrolment.

```{r boxplot, fig.cap="Percentage of Enrollment among different universities throughout US", fig.align='center', message=FALSE, warning=FALSE,fig.height=6}

# total minority  is the sum of all minority sections like asian , black etc so removed that 
# used letter value plot instead of box plot to deal with outliers

diversity_school_excludedtm <- diversity_school %>% mutate(Per = enrollment/total_enrollment*100) %>%
  filter(category!="Total Minority")
diversity_school_excludedtm$category <- recode(diversity_school_excludedtm$category,
                                  "Two Or More Races"="Other",
                                  "Unknown"="Other",
                                  "Non-Resident Foreign"="Other") 

ggplot(data=diversity_school_excludedtm) + 
 geom_lv(aes(x=category,y=Per,fill=..LV..)) +
scale_fill_viridis_d() + 
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10))+
  
  theme(axis.text.x = element_text(angle=90))

```

To calculate the percentage of US university enrolment amongst various ethinic groups, first we removed the Total Minority as it was a summation of all minority sections classfied as  'asian', 'black' etc. Besides we added *Two Or More Races*, *Unknown* and *Non-Resident Foreign* to the other category. Then to plot the values, we utilized a *Letter Value Boxplot* using the *lvplot* R package instead of a traditional boxplot as can be seen in figure \@ref(fig:)

A letter value boxplot overcomes the shortcomings of a coventional boxplot and conveys more information in the the tails or the outliers using letter values. The legend besides the letter value plot mentions certain alphabets and the color they represent on the letter value plot.

- M represents the median and roughly 50% of the observations.
- F represents the quartiles and roughly 25% of the observations.
- E denotes roughly 12.5% of the observations.
- D denotes roughly 6.25% of the observations.
- C denotes roughly 3.13% of the observations.
- B denotes roughly 1.56% of the observations.
- A denotes roughly 0.8% of the observations.
- Z denotes roughly 0.4% of the observations.
- Y denotes roughly 0.2% of the observations.
- X denotes roughly 0.1% of the observations.
- W denotes roughly 0.05% of the observations.

It is clear from figure \@ref(fig:) that white people form the majority of students enrolled in American universities followed by black people and other minorities.

## Is diversity amongst students in the United States the same across all states and universities?



### states

```{r}
library(leaflet)

library(usmap)
states <- geojsonio::geojson_read("json/us-states.geojson", what = "sp")

min <- diversity_school %>% 
  filter(category=="Total Minority") %>% 
  mutate(minoritypercent = (enrollment/total_enrollment)*100) %>%
  group_by(state) %>% 
  summarise(meanminority=mean(minoritypercent,na.rm = T)) 

min$meanminority <- round(min$meanminority,2)


 qpal <- colorNumeric("viridis", min$meanminority)
 qpalWithoutNA <- colorNumeric("viridis",min$meanminority, na.color=rgb(0,0,0,0))

labels <- sprintf(
  "<strong>%s</strong><br/>%g Percent",
  min$state, min$meanminority
) %>% lapply(htmltools::HTML)

leaflet(states,options = leafletOptions(minZoom = 4,maxZoom = 2)) %>%
  setView(-96, 37.8, 4) %>%
  addTiles() %>%
  addPolygons(
    fillColor = ~qpal(min$meanminority),
    weight = 2,
    opacity = 1,
    color = "white",
    dashArray = "3",
    fillOpacity = 0.7,
    highlight = highlightOptions(
      weight = 5,
      color = "#666",
      dashArray = "",
      fillOpacity = 0.7,
      bringToFront = TRUE),
    label = labels,
    labelOptions = labelOptions(
      style = list("font-weight" = "normal", padding = "3px 8px"),
      textsize = "15px",
      direction = "auto")) %>% 
  addLegend(pal = qpalWithoutNA, values = ~ min$meanminority, opacity = 0.7, title = "Percentage of Minority",
    position = "bottomright")


```


